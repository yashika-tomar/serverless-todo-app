{"filter":false,"title":"Todos.jsx","tooltip":"/project-final-initial/cd12101-Deploy-Application-with-AWS-Lambda/starter/client/src/components/Todos.jsx","undoManager":{"mark":5,"position":5,"stack":[[{"start":{"row":38,"column":8},"end":{"row":38,"column":49},"action":"remove","lines":["const todos = await getTodos(accessToken)"],"id":2},{"start":{"row":38,"column":8},"end":{"row":39,"column":0},"action":"insert","lines":["const todos = await getTodos(getAccessTokenSilently)",""]}],[{"start":{"row":38,"column":60},"end":{"row":39,"column":0},"action":"remove","lines":["",""],"id":3}],[{"start":{"row":0,"column":0},"end":{"row":153,"column":0},"action":"remove","lines":["import update from 'immutability-helper'","import React, { useEffect, useState } from 'react'","import {","  Button,","  Checkbox,","  Divider,","  Grid,","  Header,","  Icon,","  Image,","  Loader","} from 'semantic-ui-react'","","import { useAuth0 } from '@auth0/auth0-react'","import { useNavigate } from 'react-router-dom'","import { deleteTodo, getTodos, patchTodo } from '../api/todos-api'","import { NewTodoInput } from './NewTodoInput'","","export function Todos() {","  const { user, getAccessTokenSilently } = useAuth0()","  const [todos, setTodos] = useState([])","  const [loadingTodos, setLoadingTodos] = useState(true)","  const navigate = useNavigate()","","  console.log('User', {","    name: user.name,","    email: user.email","  })","","  useEffect(() => {","    async function loadTodos() {","      try {","        const accessToken = await getAccessTokenSilently({","          audience: process.env.REACT_APP_AUTH0_AUDIENCE","        })","","        console.log(\"Access token received:\", accessToken)","","        const todos = await getTodos(getAccessTokenSilently)","        setTodos(todos)","        setLoadingTodos(false)","      } catch (e) {","        console.log(\"Error loading todos:\", e)","        alert(`Failed to fetch todos: ${e.message}`)","      }","    }","","    loadTodos()","  }, [getAccessTokenSilently])","","  async function onTodoDelete(todoId) {","    try {","      const accessToken = await getAccessTokenSilently({","        audience: process.env.REACT_APP_AUTH0_AUDIENCE","      })","","      await deleteTodo(accessToken, todoId)","      setTodos(todos.filter((todo) => todo.todoId !== todoId))","    } catch (e) {","      alert('Todo deletion failed')","    }","  }","","  async function onTodoCheck(pos) {","    try {","      const todo = todos[pos]","      const accessToken = await getAccessTokenSilently({","        audience: process.env.REACT_APP_AUTH0_AUDIENCE","      })","","      await patchTodo(accessToken, todo.todoId, {","        name: todo.name,","        dueDate: todo.dueDate,","        done: !todo.done","      })","","      setTodos(update(todos, {","        [pos]: { done: { $set: !todo.done } }","      }))","    } catch (e) {","      console.log('Failed to check a TODO', e)","      alert('Todo update failed')","    }","  }","","  function onEditButtonClick(todoId) {","    navigate(`/todos/${todoId}/edit`)","  }","","  function renderTodos() {","    if (loadingTodos) return renderLoading()","    return renderTodosList()","  }","","  function renderTodosList() {","    return (","      <Grid padded>","        {todos.map((todo, pos) => (","          <Grid.Row key={todo.todoId}>","            <Grid.Column width={1} verticalAlign=\"middle\">","              <Checkbox","                onChange={() => onTodoCheck(pos)}","                checked={todo.done}","              />","            </Grid.Column>","            <Grid.Column width={10} verticalAlign=\"middle\">","              {todo.name}","            </Grid.Column>","            <Grid.Column width={3} floated=\"right\">","              {todo.dueDate}","            </Grid.Column>","            <Grid.Column width={1} floated=\"right\">","              <Button icon color=\"blue\" onClick={() => onEditButtonClick(todo.todoId)}>","                <Icon name=\"pencil\" />","              </Button>","            </Grid.Column>","            <Grid.Column width={1} floated=\"right\">","              <Button icon color=\"red\" onClick={() => onTodoDelete(todo.todoId)}>","                <Icon name=\"delete\" />","              </Button>","            </Grid.Column>","","            {todo.attachmentUrl && (","              <Image src={todo.attachmentUrl} size=\"small\" wrapped />","            )}","","            <Grid.Column width={16}>","              <Divider />","            </Grid.Column>","          </Grid.Row>","        ))}","      </Grid>","    )","  }","","  return (","    <div>","      <Header as=\"h1\">TODOs</Header>","      <NewTodoInput onNewTodo={(newTodo) => setTodos([...todos, newTodo])} />","      {renderTodos()}","    </div>","  )","}","","function renderLoading() {","  return (","    <Grid.Row>","      <Loader indeterminate active inline=\"centered\">","        Loading TODOs","      </Loader>","    </Grid.Row>","  )","}",""],"id":4},{"start":{"row":0,"column":0},"end":{"row":158,"column":0},"action":"insert","lines":["import update from 'immutability-helper'","import React, { useEffect, useState } from 'react'","import {","  Button,","  Checkbox,","  Divider,","  Grid,","  Header,","  Icon,","  Image,","  Loader","} from 'semantic-ui-react'","","import { useAuth0 } from '@auth0/auth0-react'","import { useNavigate } from 'react-router-dom'","import { deleteTodo, getTodos, patchTodo } from '../api/todos-api'","import { NewTodoInput } from './NewTodoInput'","","export function Todos() {","  const { user, getAccessTokenSilently } = useAuth0()","  const [todos, setTodos] = useState([])","  const [loadingTodos, setLoadingTodos] = useState(true)","  const navigate = useNavigate()","","  console.log('User', {","    name: user.name,","    email: user.email","  })","","  useEffect(() => {","    async function loadTodos() {","      try {","        // ✔ Get access token correctly","        const accessToken = await getAccessTokenSilently({","          audience: process.env.REACT_APP_AUTH0_AUDIENCE,","          scope: \"openid profile email\"","        })","","        console.log(\"Access token received:\", accessToken)","","        // ❗ FIX: Pass accessToken, not the function","        const todosList = await getTodos(accessToken)","","        setTodos(todosList)","        setLoadingTodos(false)","      } catch (e) {","        console.log(\"Error loading todos:\", e)","        alert(`Failed to fetch todos: ${e.message}`)","      }","    }","","    loadTodos()","  }, [getAccessTokenSilently])","","  async function onTodoDelete(todoId) {","    try {","      const accessToken = await getAccessTokenSilently({","        audience: process.env.REACT_APP_AUTH0_AUDIENCE","      })","","      await deleteTodo(accessToken, todoId)","      setTodos(todos.filter((todo) => todo.todoId !== todoId))","    } catch (e) {","      alert('Todo deletion failed')","    }","  }","","  async function onTodoCheck(pos) {","    try {","      const todo = todos[pos]","","      const accessToken = await getAccessTokenSilently({","        audience: process.env.REACT_APP_AUTH0_AUDIENCE","      })","","      await patchTodo(accessToken, todo.todoId, {","        name: todo.name,","        dueDate: todo.dueDate,","        done: !todo.done","      })","","      setTodos(update(todos, {","        [pos]: { done: { $set: !todo.done } }","      }))","    } catch (e) {","      console.log('Failed to check a TODO', e)","      alert('Todo update failed')","    }","  }","","  function onEditButtonClick(todoId) {","    navigate(`/todos/${todoId}/edit`)","  }","","  function renderTodos() {","    if (loadingTodos) return renderLoading()","    return renderTodosList()","  }","","  function renderTodosList() {","    return (","      <Grid padded>","        {todos.map((todo, pos) => (","          <Grid.Row key={todo.todoId}>","            <Grid.Column width={1} verticalAlign=\"middle\">","              <Checkbox","                onChange={() => onTodoCheck(pos)}","                checked={todo.done}","              />","            </Grid.Column>","            <Grid.Column width={10} verticalAlign=\"middle\">","              {todo.name}","            </Grid.Column>","            <Grid.Column width={3} floated=\"right\">","              {todo.dueDate}","            </Grid.Column>","            <Grid.Column width={1} floated=\"right\">","              <Button icon color=\"blue\" onClick={() => onEditButtonClick(todo.todoId)}>","                <Icon name=\"pencil\" />","              </Button>","            </Grid.Column>","            <Grid.Column width={1} floated=\"right\">","              <Button icon color=\"red\" onClick={() => onTodoDelete(todo.todoId)}>","                <Icon name=\"delete\" />","              </Button>","            </Grid.Column>","","            {todo.attachmentUrl && (","              <Image src={todo.attachmentUrl} size=\"small\" wrapped />","            )}","","            <Grid.Column width={16}>","              <Divider />","            </Grid.Column>","          </Grid.Row>","        ))}","      </Grid>","    )","  }","","  return (","    <div>","      <Header as=\"h1\">TODOs</Header>","      <NewTodoInput onNewTodo={(newTodo) => setTodos([...todos, newTodo])} />","      {renderTodos()}","    </div>","  )","}","","function renderLoading() {","  return (","    <Grid.Row>","      <Loader indeterminate active inline=\"centered\">","        Loading TODOs","      </Loader>","    </Grid.Row>","  )","}",""]}],[{"start":{"row":29,"column":2},"end":{"row":52,"column":30},"action":"remove","lines":["useEffect(() => {","    async function loadTodos() {","      try {","        // ✔ Get access token correctly","        const accessToken = await getAccessTokenSilently({","          audience: process.env.REACT_APP_AUTH0_AUDIENCE,","          scope: \"openid profile email\"","        })","","        console.log(\"Access token received:\", accessToken)","","        // ❗ FIX: Pass accessToken, not the function","        const todosList = await getTodos(accessToken)","","        setTodos(todosList)","        setLoadingTodos(false)","      } catch (e) {","        console.log(\"Error loading todos:\", e)","        alert(`Failed to fetch todos: ${e.message}`)","      }","    }","","    loadTodos()","  }, [getAccessTokenSilently])"],"id":6},{"start":{"row":29,"column":2},"end":{"row":52,"column":0},"action":"insert","lines":["useEffect(() => {","  async function loadTodos() {","    try {","      const accessToken = await getAccessTokenSilently({","        audience: process.env.REACT_APP_AUTH0_AUDIENCE","      })","","      console.log(\"Access token received:\", accessToken)","","      // ❗ REAL FIX — pass accessToken, not getAccessTokenSilently","      const todosList = await getTodos(accessToken)","","      setTodos(todosList)","      setLoadingTodos(false)","","    } catch (e) {","      console.log(\"Error loading todos:\", e)","      alert(`Failed to fetch todos: ${e.message}`)","    }","  }","","  loadTodos()","}, [getAccessTokenSilently])",""]}],[{"start":{"row":38,"column":6},"end":{"row":38,"column":66},"action":"remove","lines":["// ❗ REAL FIX — pass accessToken, not getAccessTokenSilently"],"id":7},{"start":{"row":38,"column":4},"end":{"row":38,"column":6},"action":"remove","lines":["  "]},{"start":{"row":38,"column":2},"end":{"row":38,"column":4},"action":"remove","lines":["  "]},{"start":{"row":38,"column":0},"end":{"row":38,"column":2},"action":"remove","lines":["  "]},{"start":{"row":37,"column":0},"end":{"row":38,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":0,"column":0},"end":{"row":157,"column":0},"action":"remove","lines":["import update from 'immutability-helper'","import React, { useEffect, useState } from 'react'","import {","  Button,","  Checkbox,","  Divider,","  Grid,","  Header,","  Icon,","  Image,","  Loader","} from 'semantic-ui-react'","","import { useAuth0 } from '@auth0/auth0-react'","import { useNavigate } from 'react-router-dom'","import { deleteTodo, getTodos, patchTodo } from '../api/todos-api'","import { NewTodoInput } from './NewTodoInput'","","export function Todos() {","  const { user, getAccessTokenSilently } = useAuth0()","  const [todos, setTodos] = useState([])","  const [loadingTodos, setLoadingTodos] = useState(true)","  const navigate = useNavigate()","","  console.log('User', {","    name: user.name,","    email: user.email","  })","","  useEffect(() => {","  async function loadTodos() {","    try {","      const accessToken = await getAccessTokenSilently({","        audience: process.env.REACT_APP_AUTH0_AUDIENCE","      })","","      console.log(\"Access token received:\", accessToken)","","      const todosList = await getTodos(accessToken)","","      setTodos(todosList)","      setLoadingTodos(false)","","    } catch (e) {","      console.log(\"Error loading todos:\", e)","      alert(`Failed to fetch todos: ${e.message}`)","    }","  }","","  loadTodos()","}, [getAccessTokenSilently])","","","  async function onTodoDelete(todoId) {","    try {","      const accessToken = await getAccessTokenSilently({","        audience: process.env.REACT_APP_AUTH0_AUDIENCE","      })","","      await deleteTodo(accessToken, todoId)","      setTodos(todos.filter((todo) => todo.todoId !== todoId))","    } catch (e) {","      alert('Todo deletion failed')","    }","  }","","  async function onTodoCheck(pos) {","    try {","      const todo = todos[pos]","","      const accessToken = await getAccessTokenSilently({","        audience: process.env.REACT_APP_AUTH0_AUDIENCE","      })","","      await patchTodo(accessToken, todo.todoId, {","        name: todo.name,","        dueDate: todo.dueDate,","        done: !todo.done","      })","","      setTodos(update(todos, {","        [pos]: { done: { $set: !todo.done } }","      }))","    } catch (e) {","      console.log('Failed to check a TODO', e)","      alert('Todo update failed')","    }","  }","","  function onEditButtonClick(todoId) {","    navigate(`/todos/${todoId}/edit`)","  }","","  function renderTodos() {","    if (loadingTodos) return renderLoading()","    return renderTodosList()","  }","","  function renderTodosList() {","    return (","      <Grid padded>","        {todos.map((todo, pos) => (","          <Grid.Row key={todo.todoId}>","            <Grid.Column width={1} verticalAlign=\"middle\">","              <Checkbox","                onChange={() => onTodoCheck(pos)}","                checked={todo.done}","              />","            </Grid.Column>","            <Grid.Column width={10} verticalAlign=\"middle\">","              {todo.name}","            </Grid.Column>","            <Grid.Column width={3} floated=\"right\">","              {todo.dueDate}","            </Grid.Column>","            <Grid.Column width={1} floated=\"right\">","              <Button icon color=\"blue\" onClick={() => onEditButtonClick(todo.todoId)}>","                <Icon name=\"pencil\" />","              </Button>","            </Grid.Column>","            <Grid.Column width={1} floated=\"right\">","              <Button icon color=\"red\" onClick={() => onTodoDelete(todo.todoId)}>","                <Icon name=\"delete\" />","              </Button>","            </Grid.Column>","","            {todo.attachmentUrl && (","              <Image src={todo.attachmentUrl} size=\"small\" wrapped />","            )}","","            <Grid.Column width={16}>","              <Divider />","            </Grid.Column>","          </Grid.Row>","        ))}","      </Grid>","    )","  }","","  return (","    <div>","      <Header as=\"h1\">TODOs</Header>","      <NewTodoInput onNewTodo={(newTodo) => setTodos([...todos, newTodo])} />","      {renderTodos()}","    </div>","  )","}","","function renderLoading() {","  return (","    <Grid.Row>","      <Loader indeterminate active inline=\"centered\">","        Loading TODOs","      </Loader>","    </Grid.Row>","  )","}",""],"id":8},{"start":{"row":0,"column":0},"end":{"row":148,"column":0},"action":"insert","lines":["import update from 'immutability-helper'","import React, { useEffect, useState } from 'react'","import {","  Button,","  Checkbox,","  Divider,","  Grid,","  Header,","  Icon,","  Image,","  Loader","} from 'semantic-ui-react'","","import { useAuth0 } from '@auth0/auth0-react'","import { useNavigate } from 'react-router-dom'","import { deleteTodo, getTodos, patchTodo } from '../api/todos-api'","import { NewTodoInput } from './NewTodoInput'","","export function Todos() {","  const { user, getAccessTokenSilently } = useAuth0()","  const [todos, setTodos] = useState([])","  const [loadingTodos, setLoadingTodos] = useState(true)","  const navigate = useNavigate()","","  useEffect(() => {","    async function loadTodos() {","      try {","        const token = await getAccessTokenSilently({","          audience: process.env.REACT_APP_AUTH0_AUDIENCE","        })","","        const items = await getTodos(token)","        setTodos(items)","        setLoadingTodos(false)","      } catch (e) {","        console.log(\"Error loading todos:\", e)","        alert(`Failed to fetch todos: ${e.message}`)","      }","    }","","    loadTodos()","  }, [getAccessTokenSilently])","","  async function onTodoDelete(todoId) {","    try {","      const token = await getAccessTokenSilently({","        audience: process.env.REACT_APP_AUTH0_AUDIENCE","      })","","      await deleteTodo(token, todoId)","      setTodos(todos.filter((todo) => todo.todoId !== todoId))","    } catch (e) {","      alert('Todo deletion failed')","    }","  }","","  async function onTodoCheck(pos) {","    try {","      const todo = todos[pos]","","      const token = await getAccessTokenSilently({","        audience: process.env.REACT_APP_AUTH0_AUDIENCE","      })","","      await patchTodo(token, todo.todoId, {","        name: todo.name,","        dueDate: todo.dueDate,","        done: !todo.done","      })","","      setTodos(","        update(todos, {","          [pos]: { done: { $set: !todo.done } }","        })","      )","    } catch (e) {","      alert('Todo update failed')","    }","  }","","  function onEditButtonClick(todoId) {","    navigate(`/todos/${todoId}/edit`)","  }","","  function renderTodos() {","    if (loadingTodos) return renderLoading()","    return renderTodosList()","  }","","  function renderTodosList() {","    return (","      <Grid padded>","        {todos.map((todo, pos) => (","          <Grid.Row key={todo.todoId}>","            <Grid.Column width={1} verticalAlign=\"middle\">","              <Checkbox","                onChange={() => onTodoCheck(pos)}","                checked={todo.done}","              />","            </Grid.Column>","","            <Grid.Column width={10} verticalAlign=\"middle\">","              {todo.name}","            </Grid.Column>","","            <Grid.Column width={3}>{todo.dueDate}</Grid.Column>","","            <Grid.Column width={1}>","              <Button icon color=\"blue\" onClick={() => onEditButtonClick(todo.todoId)}>","                <Icon name=\"pencil\" />","              </Button>","            </Grid.Column>","","            <Grid.Column width={1}>","              <Button icon color=\"red\" onClick={() => onTodoDelete(todo.todoId)}>","                <Icon name=\"delete\" />","              </Button>","            </Grid.Column>","","            {todo.attachmentUrl && <Image src={todo.attachmentUrl} size=\"small\" />}","","            <Grid.Column width={16}>","              <Divider />","            </Grid.Column>","          </Grid.Row>","        ))}","      </Grid>","    )","  }","","  return (","    <div>","      <Header as=\"h1\">TODOs</Header>","      <NewTodoInput onNewTodo={(todo) => setTodos([...todos, todo])} />","      {renderTodos()}","    </div>","  )","}","","function renderLoading() {","  return (","    <Grid.Row>","      <Loader indeterminate active inline=\"centered\">","        Loading TODOs","      </Loader>","    </Grid.Row>","  )","}",""]}]]},"ace":{"folds":[],"scrolltop":1818,"scrollleft":0,"selection":{"start":{"row":148,"column":0},"end":{"row":148,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1763845735798,"hash":"7a5c53df08e8f086542ae5c0e42014c1e242b164"}