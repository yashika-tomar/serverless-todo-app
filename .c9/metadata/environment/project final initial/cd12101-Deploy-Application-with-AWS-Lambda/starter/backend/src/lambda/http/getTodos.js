{"filter":false,"title":"getTodos.js","tooltip":"/project final initial/cd12101-Deploy-Application-with-AWS-Lambda/starter/backend/src/lambda/http/getTodos.js","undoManager":{"mark":2,"position":2,"stack":[[{"start":{"row":0,"column":0},"end":{"row":4,"column":0},"action":"remove","lines":["export function handler(event) {","  // TODO: Get all TODO items for a current user","  return undefined","}",""],"id":2},{"start":{"row":0,"column":0},"end":{"row":38,"column":1},"action":"insert","lines":["import AWS from 'aws-sdk'","import { createLogger } from '../../utils/logger.mjs'","","const logger = createLogger('todos')","const docClient = new AWS.DynamoDB.DocumentClient()","const todosTable = process.env.TODOS_TABLE","","export async function handler(event) {","  const userId = event.requestContext.authorizer.userId","","  try {","    // Query DynamoDB for all TODOs for the current user","    const result = await docClient","      .query({","        TableName: todosTable,","        KeyConditionExpression: 'userId = :userId',","        ExpressionAttributeValues: {","          ':userId': userId","        }","      })","      .promise()","","    const items = result.Items","","    logger.info('Fetched TODOs', { userId, count: items.length })","","    return {","      statusCode: 200,","      body: JSON.stringify({ items })","    }","  } catch (error) {","    logger.error('Error fetching TODOs', { error })","","    return {","      statusCode: 500,","      body: JSON.stringify({ error: 'Could not fetch TODOs' })","    }","  }","}"]}],[{"start":{"row":0,"column":0},"end":{"row":38,"column":1},"action":"remove","lines":["import AWS from 'aws-sdk'","import { createLogger } from '../../utils/logger.mjs'","","const logger = createLogger('todos')","const docClient = new AWS.DynamoDB.DocumentClient()","const todosTable = process.env.TODOS_TABLE","","export async function handler(event) {","  const userId = event.requestContext.authorizer.userId","","  try {","    // Query DynamoDB for all TODOs for the current user","    const result = await docClient","      .query({","        TableName: todosTable,","        KeyConditionExpression: 'userId = :userId',","        ExpressionAttributeValues: {","          ':userId': userId","        }","      })","      .promise()","","    const items = result.Items","","    logger.info('Fetched TODOs', { userId, count: items.length })","","    return {","      statusCode: 200,","      body: JSON.stringify({ items })","    }","  } catch (error) {","    logger.error('Error fetching TODOs', { error })","","    return {","      statusCode: 500,","      body: JSON.stringify({ error: 'Could not fetch TODOs' })","    }","  }","}"],"id":3},{"start":{"row":0,"column":0},"end":{"row":47,"column":0},"action":"insert","lines":["import AWS from 'aws-sdk'","import { createLogger } from '../../utils/logger.mjs'","","const logger = createLogger('todos')","const docClient = new AWS.DynamoDB.DocumentClient()","const todosTable = process.env.TODOS_TABLE","","export async function handler(event) {","  const userId = event.requestContext.authorizer.userId","","  try {","    // Query DynamoDB for all TODOs for the current user","    const result = await docClient","      .query({","        TableName: todosTable,","        KeyConditionExpression: 'userId = :userId',","        ExpressionAttributeValues: {","          ':userId': userId","        }","      })","      .promise()","","    const items = result.Items","","    logger.info('Fetched TODOs', { userId, count: items.length })","","    return {","      statusCode: 200,","      headers: {","        \"Access-Control-Allow-Origin\": \"*\",","        \"Access-Control-Allow-Credentials\": true","      },","      body: JSON.stringify({ items })","    }","  } catch (error) {","    logger.error('Error fetching TODOs', { error })","","    return {","      statusCode: 500,","      headers: {","        \"Access-Control-Allow-Origin\": \"*\",","        \"Access-Control-Allow-Credentials\": true","      },","      body: JSON.stringify({ error: 'Could not fetch TODOs' })","    }","  }","}",""]}],[{"start":{"row":0,"column":0},"end":{"row":47,"column":0},"action":"remove","lines":["import AWS from 'aws-sdk'","import { createLogger } from '../../utils/logger.mjs'","","const logger = createLogger('todos')","const docClient = new AWS.DynamoDB.DocumentClient()","const todosTable = process.env.TODOS_TABLE","","export async function handler(event) {","  const userId = event.requestContext.authorizer.userId","","  try {","    // Query DynamoDB for all TODOs for the current user","    const result = await docClient","      .query({","        TableName: todosTable,","        KeyConditionExpression: 'userId = :userId',","        ExpressionAttributeValues: {","          ':userId': userId","        }","      })","      .promise()","","    const items = result.Items","","    logger.info('Fetched TODOs', { userId, count: items.length })","","    return {","      statusCode: 200,","      headers: {","        \"Access-Control-Allow-Origin\": \"*\",","        \"Access-Control-Allow-Credentials\": true","      },","      body: JSON.stringify({ items })","    }","  } catch (error) {","    logger.error('Error fetching TODOs', { error })","","    return {","      statusCode: 500,","      headers: {","        \"Access-Control-Allow-Origin\": \"*\",","        \"Access-Control-Allow-Credentials\": true","      },","      body: JSON.stringify({ error: 'Could not fetch TODOs' })","    }","  }","}",""],"id":4},{"start":{"row":0,"column":0},"end":{"row":47,"column":0},"action":"insert","lines":["import AWS from 'aws-sdk'","import { createLogger } from '../../utils/logger.mjs'","","const logger = createLogger('todos')","const docClient = new AWS.DynamoDB.DocumentClient()","const todosTable = process.env.TODOS_TABLE","","export async function handler(event) {","  // FIX: authorizer returns principalId, not userId","  const userId = event.requestContext.authorizer.principalId","","  try {","    // Query DynamoDB for all TODOs for the current user","    const result = await docClient.query({","      TableName: todosTable,","      KeyConditionExpression: 'userId = :userId',","      ExpressionAttributeValues: {","        ':userId': userId","      }","    }).promise()","","    const items = result.Items","","    logger.info('Fetched TODOs', { userId, count: items.length })","","    return {","      statusCode: 200,","      headers: {","        \"Access-Control-Allow-Origin\": \"*\",","        \"Access-Control-Allow-Credentials\": true","      },","      body: JSON.stringify({ items })","    }","","  } catch (error) {","    logger.error('Error fetching TODOs', { error })","","    return {","      statusCode: 500,","      headers: {","        \"Access-Control-Allow-Origin\": \"*\",","        \"Access-Control-Allow-Credentials\": true","      },","      body: JSON.stringify({ error: 'Could not fetch TODOs' })","    }","  }","}",""]}]]},"ace":{"folds":[],"scrolltop":429,"scrollleft":0,"selection":{"start":{"row":34,"column":19},"end":{"row":34,"column":19},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":29,"state":"no_regex","mode":"ace/mode/javascript"}},"timestamp":1763839243134,"hash":"f7bca475c499b813b55db6963365f68d5a5dbdf8"}