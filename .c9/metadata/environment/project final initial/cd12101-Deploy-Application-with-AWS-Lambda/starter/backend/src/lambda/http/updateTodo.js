{"filter":false,"title":"updateTodo.js","tooltip":"/project final initial/cd12101-Deploy-Application-with-AWS-Lambda/starter/backend/src/lambda/http/updateTodo.js","undoManager":{"mark":5,"position":5,"stack":[[{"start":{"row":0,"column":0},"end":{"row":7,"column":0},"action":"remove","lines":["export function handler(event) {","  const todoId = event.pathParameters.todoId","  const updatedTodo = JSON.parse(event.body)","  ","  // TODO: Update a TODO item with the provided id using values in the \"updatedTodo\" object","  return undefined","}",""],"id":2},{"start":{"row":0,"column":0},"end":{"row":48,"column":1},"action":"insert","lines":["import AWS from 'aws-sdk'","import { createLogger } from '../../utils/logger.mjs'","","const logger = createLogger('todos')","const docClient = new AWS.DynamoDB.DocumentClient()","const todosTable = process.env.TODOS_TABLE","","export async function handler(event) {","  const todoId = event.pathParameters.todoId","  const updatedTodo = JSON.parse(event.body)","  const userId = event.requestContext.authorizer.userId","","  try {","    // Update the TODO item in DynamoDB","    await docClient","      .update({","        TableName: todosTable,","        Key: {","          todoId: todoId,","          userId: userId","        },","        UpdateExpression: 'set #name = :name, dueDate = :dueDate, done = :done',","        ExpressionAttributeNames: {","          '#name': 'name'","        },","        ExpressionAttributeValues: {","          ':name': updatedTodo.name,","          ':dueDate': updatedTodo.dueDate,","          ':done': updatedTodo.done","        },","        ReturnValues: 'ALL_NEW'","      })","      .promise()","","    logger.info('Updated TODO', { todoId, userId, updatedTodo })","","    return {","      statusCode: 200,","      body: JSON.stringify({ message: 'Todo updated successfully' })","    }","  } catch (error) {","    logger.error('Error updating TODO', { error })","","    return {","      statusCode: 500,","      body: JSON.stringify({ error: 'Could not update TODO' })","    }","  }","}"]}],[{"start":{"row":37,"column":22},"end":{"row":38,"column":0},"action":"insert","lines":["",""],"id":3},{"start":{"row":38,"column":0},"end":{"row":38,"column":6},"action":"insert","lines":["      "]}],[{"start":{"row":38,"column":6},"end":{"row":42,"column":0},"action":"insert","lines":["headers: {","  \"Access-Control-Allow-Origin\": \"*\",","  \"Access-Control-Allow-Credentials\": true","},",""],"id":4}],[{"start":{"row":49,"column":22},"end":{"row":50,"column":0},"action":"insert","lines":["",""],"id":5},{"start":{"row":50,"column":0},"end":{"row":50,"column":6},"action":"insert","lines":["      "]}],[{"start":{"row":50,"column":6},"end":{"row":54,"column":0},"action":"insert","lines":["headers: {","  \"Access-Control-Allow-Origin\": \"*\",","  \"Access-Control-Allow-Credentials\": true","},",""],"id":6}],[{"start":{"row":0,"column":0},"end":{"row":58,"column":1},"action":"remove","lines":["import AWS from 'aws-sdk'","import { createLogger } from '../../utils/logger.mjs'","","const logger = createLogger('todos')","const docClient = new AWS.DynamoDB.DocumentClient()","const todosTable = process.env.TODOS_TABLE","","export async function handler(event) {","  const todoId = event.pathParameters.todoId","  const updatedTodo = JSON.parse(event.body)","  const userId = event.requestContext.authorizer.userId","","  try {","    // Update the TODO item in DynamoDB","    await docClient","      .update({","        TableName: todosTable,","        Key: {","          todoId: todoId,","          userId: userId","        },","        UpdateExpression: 'set #name = :name, dueDate = :dueDate, done = :done',","        ExpressionAttributeNames: {","          '#name': 'name'","        },","        ExpressionAttributeValues: {","          ':name': updatedTodo.name,","          ':dueDate': updatedTodo.dueDate,","          ':done': updatedTodo.done","        },","        ReturnValues: 'ALL_NEW'","      })","      .promise()","","    logger.info('Updated TODO', { todoId, userId, updatedTodo })","","    return {","      statusCode: 200,","      headers: {","  \"Access-Control-Allow-Origin\": \"*\",","  \"Access-Control-Allow-Credentials\": true","},","","      body: JSON.stringify({ message: 'Todo updated successfully' })","    }","  } catch (error) {","    logger.error('Error updating TODO', { error })","","    return {","      statusCode: 500,","      headers: {","  \"Access-Control-Allow-Origin\": \"*\",","  \"Access-Control-Allow-Credentials\": true","},","","      body: JSON.stringify({ error: 'Could not update TODO' })","    }","  }","}"],"id":7},{"start":{"row":0,"column":0},"end":{"row":59,"column":0},"action":"insert","lines":["import AWS from 'aws-sdk'","import { createLogger } from '../../utils/logger.mjs'","","const logger = createLogger('todos')","const docClient = new AWS.DynamoDB.DocumentClient()","const todosTable = process.env.TODOS_TABLE","","export async function handler(event) {","  const todoId = event.pathParameters.todoId","  const updatedTodo = JSON.parse(event.body)","","  // FIX: correct userId from authorizer","  const userId = event.requestContext.authorizer.principalId","","  try {","    // Update the TODO item in DynamoDB","    await docClient.update({","      TableName: todosTable,","      Key: {","        userId: userId,","        todoId: todoId","      },","      UpdateExpression:","        'set #name = :name, dueDate = :dueDate, done = :done',","      ExpressionAttributeNames: {","        '#name': 'name'","      },","      ExpressionAttributeValues: {","        ':name': updatedTodo.name,","        ':dueDate': updatedTodo.dueDate,","        ':done': updatedTodo.done","      },","      ReturnValues: 'UPDATED_NEW'","    }).promise()","","    logger.info('Updated TODO', { todoId, userId, updatedTodo })","","    return {","      statusCode: 200,","      headers: {","        \"Access-Control-Allow-Origin\": \"*\",","        \"Access-Control-Allow-Credentials\": true","      },","      body: JSON.stringify({ message: 'Todo updated successfully' })","    }","","  } catch (error) {","    logger.error('Error updating TODO', { error })","","    return {","      statusCode: 500,","      headers: {","        \"Access-Control-Allow-Origin\": \"*\",","        \"Access-Control-Allow-Credentials\": true","      },","      body: JSON.stringify({ error: 'Could not update TODO' })","    }","  }","}",""]}]]},"ace":{"folds":[],"scrolltop":597,"scrollleft":0,"selection":{"start":{"row":49,"column":12},"end":{"row":49,"column":12},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":41,"state":"no_regex","mode":"ace/mode/javascript"}},"timestamp":1763838749559,"hash":"502d3f15af251f156541df54f0b62325429982fa"}